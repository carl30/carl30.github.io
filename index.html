<!DOCTYPE html>
<html>
<head>
    <title>Carl's DeepSeek Assistant</title>
    <style>
        #chat-container { max-width: 600px; margin: 2rem auto; padding: 20px; font-family: Arial, sans-serif; }
        #response { height: 400px; overflow-y: auto; border: 1px solid #e1e4e8; border-radius: 8px; padding: 15px; margin-bottom: 15px; background: #f6f8fa; }
        #user-input { width: 75%; padding: 10px; border: 1px solid #d1d5da; border-radius: 4px; }
        button { padding: 10px 15px; background: #2ea44f; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .user-msg { color: #24292e; margin-bottom: 10px; }
        .assistant-msg { color: #0366d6; margin-bottom: 15px; }
    </style>
</head>
<body>
    <div id="chat-container">
        <h1>Carl's Personal Assistant 🤖</h1>
        <div id="response"></div>
        <div>
            <input type="text" id="user-input" placeholder="Ask something about Carl...">
            <button onclick="sendMessage()">Send</button>
        </div>
    </div>
    <div>Hello!I'm Carl.</div>

    <script>
        // 简历文本 - 替换为你的实际简历内容
        const carlResume = `
        Carl's Professional Resume
        --------------------------
        Name: 何家俊 Carl He
        Role: Senior Backend Engineer
        Skills: Go, Kubernetes, AWS, Distributed Systems
        Experience: 
          - TechLead at XYZ (2020-Present)
          - Senior Dev at ABC (2018-2020)
        Education: MIT Computer Science
        Projects:
          - Built scalable microservices architecture
          - Implemented CI/CD pipeline for 50+ services
        `.replace(/\n/g, " "); // 压缩为单行

        // Cloudflare Workers 代理端点
        const WORKER_URL = "https://github-ds-apikey.ahjun30.workers.dev";
        
        // 增强版输入验证
        function validateInput(input) {
            const lowerInput = input.toLowerCase();
            const carlKeywords = ["carl", "resume", "experience", "skills", "project", "education", "work"];
            
            // 检查是否包含Carl相关关键词
            const isAboutCarl = carlKeywords.some(kw => lowerInput.includes(kw));
            
            // 检查是否包含禁止主题关键词
            const forbiddenTopics = ["how to", "tutorial", "explain", "what is", "help me", "unrelated"];
            const isForbidden = forbiddenTopics.some(topic => lowerInput.includes(topic));
            
            return isAboutCarl && !isForbidden;
        }

        async function sendMessage() {
            const inputElement = document.getElementById('user-input');
            const input = inputElement.value.trim();
            const responseContainer = document.getElementById('response');
            
            if (!input) return;
            
            // 清空输入框
            inputElement.value = "";
            
            // 显示用户消息
            responseContainer.innerHTML += `<div class="user-msg"><strong>You:</strong> ${input}</div>`;
            
            // 滚动到底部
            responseContainer.scrollTop = responseContainer.scrollHeight;
            
            // 输入验证
            // if (!validateInput(input)) {
            //     responseContainer.innerHTML += `<div class="assistant-msg"><strong>Assistant:</strong> I can only answer questions about Carl's professional background. Please ask about his resume, skills, or experience.</div>`;
            //     responseContainer.scrollTop = responseContainer.scrollHeight;
            //     return;
            // }

            // 系统提示词（强化限制）
            const systemPrompt = `
            ROLE: You are Carl's personal assistant.
            RULES:
            1. STRICTLY answer ONLY about Carl's professional background (resume, skills, experience)
            2. REJECT ALL other topics with: "I specialize only in Carl-related topics"
            3. USE this resume context: ${carlResume}
            4. RESPONSE FORMAT: Concise, professional answers under 3 sentences
            `.trim();

            try {
                // 调用 Cloudflare Workers 代理
                const response = await fetch(WORKER_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [
                            { role: "system", content: systemPrompt },
                            { role: "user", content: input }
                        ],
                        temperature: 0.3,
                        max_tokens: 150
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                const reply = data.choices[0].message.content;
                
                // 显示AI回复
                responseContainer.innerHTML += `<div class="assistant-msg"><strong>Assistant:</strong> ${reply}</div>`;
                
                // 滚动到底部
                responseContainer.scrollTop = responseContainer.scrollHeight;
                
            } catch (error) {
                console.error("API Error:", error);
                responseContainer.innerHTML += `<div class="assistant-msg"><strong>Error:</strong> Sorry, I'm having trouble answering right now. Please try again later.</div>`;
                responseContainer.scrollTop = responseContainer.scrollHeight;
            }
        }
        
        // 支持回车键发送
        document.getElementById('user-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
    </script>
</body>
</html>
